<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MindShield | Apoio Emocional</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header>
    <div class="header-inner container">
      <img src="midia/Prancheta 1.png" alt="MindShield Logo" style="max-width: 100px; height: auto;" />
      <h1> MindShield</h1>
      <nav>
        <a href="index.html">In√≠cio</a>
        <a href="apoio.html">Apoio</a>
        <a href="galeria.html">Galeria</a>
        <a href="informacoes.html">Informa√ß√µes</a>
        <a href="contato.html">Contato</a>
      </nav>
      <button id="theme-toggle" title="Alternar tema">üåô</button>
    </div>
  </header>

  <!-- ===== MAIN ===== -->
  <main class="container">
    <section class="hero">
      <h2>Converse com a MindShield IA üí¨</h2>
      <p>
        Nossa assistente virtual est√° aqui para te ouvir e oferecer apoio emocional.
        Suas mensagens s√£o tratadas com empatia e confidencialidade.
      </p>
    </section>

    <!-- ===== CHAT ===== -->
    <section>
      <div class="chat-window">
        <div id="messages"></div>

        <form id="chat-form" autocomplete="off">
          <textarea id="user-input" placeholder="Digite sua mensagem..." required></textarea>
          <button type="submit">Enviar</button>
        </form>
      </div>
    </section>

    <!-- ===== PHQ-9 ===== -->
    <section>
      <h2>Autoavalia√ß√£o de Humor (PHQ-9)</h2>
      <p>Responda brevemente como tem se sentido nos √∫ltimos dias:</p>

      <form id="phq9-form">
        <div class="grid">
          <div class="q">
            <label>1. Pouco interesse ou prazer em fazer as coisas?</label>
            <select name="q1" required>
              <option value="">Selecione</option>
              <option value="0">Nunca</option>
              <option value="1">Alguns dias</option>
              <option value="2">Mais da metade dos dias</option>
              <option value="3">Quase todos os dias</option>
            </select>
          </div>

          <div class="q">
            <label>2. Sentiu-se para baixo, deprimido ou sem esperan√ßa?</label>
            <select name="q2" required>
              <option value="">Selecione</option>
              <option value="0">Nunca</option>
              <option value="1">Alguns dias</option>
              <option value="2">Mais da metade dos dias</option>
              <option value="3">Quase todos os dias</option>
            </select>
          </div>

          <div class="q">
            <label>3. Dificuldade para dormir ou dormir demais?</label>
            <select name="q3" required>
              <option value="">Selecione</option>
              <option value="0">Nunca</option>
              <option value="1">Alguns dias</option>
              <option value="2">Mais da metade dos dias</option>
              <option value="3">Quase todos os dias</option>
            </select>
          </div>

          <div class="q">
            <label>4. Sentiu-se cansado ou com pouca energia?</label>
            <select name="q4" required>
              <option value="">Selecione</option>
              <option value="0">Nunca</option>
              <option value="1">Alguns dias</option>
              <option value="2">Mais da metade dos dias</option>
              <option value="3">Quase todos os dias</option>
            </select>
          </div>

          <div class="q">
            <label>5. Falta de apetite ou comer demais?</label>
            <select name="q5" required>
              <option value="">Selecione</option>
              <option value="0">Nunca</option>
              <option value="1">Alguns dias</option>
              <option value="2">Mais da metade dos dias</option>
              <option value="3">Quase todos os dias</option>
            </select>
          </div>
        </div>

        <button type="submit">Ver resultado</button>
        <div id="phq9-result" class="result" style="display:none;"></div>
      </form>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer>
    <p>¬© 2025 MindShield | Conversas com empatia üíõ</p>
  </footer>

  <!-- ===== SCRIPTS ===== -->


<script>
  // ===== Altern√¢ncia de Tema =====
  const toggleBtn = document.getElementById('theme-toggle');
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
  toggleBtn.textContent = savedTheme === 'dark' ? 'üåû' : 'üåô';
  toggleBtn.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    toggleBtn.textContent = next === 'dark' ? 'üåû' : 'üåô';
  });

  // ===== Chat com IA =====
  const form = document.getElementById("chat-form");
  const input = document.getElementById("user-input");
  const messagesDiv = document.getElementById("messages");
  let historico = [];

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const texto = input.value.trim();
    if (!texto) return;

    // Exibe mensagem do usu√°rio
    messagesDiv.innerHTML += `<div class="message user"><strong>Voc√™:</strong> ${texto}</div>`;
    input.value = "";
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    try {
      const resposta = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mensagem: texto, historico })
      });

      const data = await resposta.json();

      // Exibe resposta da IA
      messagesDiv.innerHTML += `<div class="message bot"><strong>MindShield IA:</strong> ${data.resposta}</div>`;
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // Atualiza hist√≥rico
      historico.push({ role: "user", content: texto });
      historico.push({ role: "assistant", content: data.resposta });

    } catch (erro) {
      console.error("Erro:", erro);
      messagesDiv.innerHTML += `<div class="message bot">‚ö†Ô∏è Erro ao se comunicar com o servidor.</div>`;
    }
  });
</script>

<script src="js/main.js"></script>


</body>
</html>
